<div class="container scrolled-content" fxFlex="1 1 auto">
    <form
        (ngSubmit)="beforeSubmit()"
        [formGroup]="form"
        class="form"
        fxFlex="0 1 50rem"
        fxLayout="column"
        fxLayoutAlign="start stretch"
    >
        <div class="form__field--row">
            <!-- Address -->
            <div class="form__field form__field-dropdown">
                <label for="send-address">
                    {{ 'SEND.ADDRESS' | translate }}
                    <span class="color-red">*</span>
                </label>
                <input
                    (contextmenu)="variablesService.onContextMenu($event)"
                    (focusout)="controllerVisibleDropdownAliasesState$.next(false)"
                    (input)="inputListenAddressField($event)"
                    (paste)="pasteListenAddressField($event)"
                    (blur)="updateAddressErrorMessage()"
                    [lowerCaseDisabled]="lowerCaseDisabled$ | async"
                    [placeholder]="'PLACEHOLDERS.ADRESS_PLACEHOLDER' | translate"
                    class="form__field--input"
                    formControlName="address"
                    id="send-address"
                    lowerCase
                    type="text"
                />

                <div
                    *ngIf="isVisibleDropdownAliasesState$ | async"
                    [ngStyle]="{
                                'z-index': 1
                            }"
                    class="dropdown py-0_5 border-radius-0_8-rem bg-light-blue-details"
                >
                    <ng-container *ngIf="aliases$ | async as aliases">
                        <ng-container *ngIf="aliases.length; else notFoundAliases">
                            <div
                                (click)="form.controls.address.patchValue(alias.name)"
                                *ngFor="let alias of aliases"
                                class="item"
                            >
                                <div
                                    [class.available]="alias.name.length >= 2 && alias.name.length <= 6"
                                    [class.pl-1]="alias.name.length > 6"
                                    class="alias"
                                >
                                    <div class="text-ellipsis">{{ alias.name }}</div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #notFoundAliases>
                            <div class="item pl-1">Not found aliases</div>
                        </ng-template>
                    </ng-container>
                </div>

                <div
                    *ngIf="isVisibleErrorByControl(form.controls.address)"
                    class="error"
                >
                    {{ errorMessages['address'] | translate }}
                </div>

                <div *ngIf="aliasAddress" class="info text-ellipsis">
                    <span>{{ aliasAddress | zanoShortString }}</span>
                </div>
            </div>

            <!-- Amount -->
            <div class="form__field">
                <label for="send-amount">
                    {{ 'SEND.AMOUNT' | translate }}
                    <span class="color-red">*</span>
                </label>
                <input
                    (contextmenu)="variablesService.onContextMenu($event)"
                    [decimalPoint]="decimal_point$ | async"
                    [placeholder]="'PLACEHOLDERS.AMOUNT_PLACEHOLDER' | translate"
                    appInputValidate="money"
                    class="form__field--input"
                    formControlName="amount"
                    id="send-amount"
                    type="text"
                />
                <div
                    *ngIf="isVisibleErrorByControl(form.controls.amount) || isVisibleErrorByForm(form)"
                    class="error"
                >
                    <div *ngIf="form.controls.amount.hasError('zero')">
                        {{ 'SEND.FORM_ERRORS.AMOUNT_ZERO' | translate }}
                    </div>
                    <div *ngIf="form.controls.amount.hasError('great_than_unwraped_coins')">
                        {{ 'SEND.FORM_ERRORS.GREAT_THAN_UNWRAPPED_COINS' | translate }}
                    </div>
                    <div *ngIf="form.controls.amount.hasError('less_than_zano_needed')">
                        {{ 'SEND.FORM_ERRORS.LESS_THAN_ZANO_NEEDED' | translate }}
                    </div>
                    <div *ngIf="form.controls.amount.hasError('wrap_info_null')">
                        {{ 'SEND.FORM_ERRORS.WRAP_INFO_NULL' | translate }}
                    </div>
                    <div *ngIf="form.controls.amount.hasError('required')">
                        {{ 'ERRORS.REQUIRED' | translate }}
                    </div>
                    <div
                        *ngIf="form.hasError('insuficcientFunds')">
                        {{ form.errors['insuficcientFunds'].errorText | translate }}
                    </div>
                    <div
                        *ngIf="form.hasError('greater_than_maximum_amount')">
                        {{ 'ERRORS.MAX' | translate: { max: form.errors['greater_than_maximum_amount'].max } }}
                    </div>
                    <div *ngIf="form.hasError('asset_not_found')">
                        {{ 'ERRORS.ASSET_NOT_FOUND' | translate }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Comment -->
        <div class="form__field">
            <label for="send-comment">{{ 'SEND.COMMENT' | translate }}</label>
            <input
                (contextmenu)="variablesService.onContextMenu($event)"
                [maxLength]="variablesService.maxCommentLength"
                class="form__field--input"
                formControlName="comment"
                id="send-comment"
                placeholder="{{ 'PLACEHOLDERS.COMMENT_PLACEHOLDER' | translate }}"
                type="text"
            />
            <div
                *ngIf="isVisibleErrorByControl(form.controls.comment)"
                class="error"
            >
                <div *ngIf="form.controls.comment.hasError('maxLength')">
                    {{ 'SEND.FORM_ERRORS.MAX_LENGTH' | translate }}
                </div>
            </div>
        </div>

        <!-- Wrap information -->
        <ng-container *ngIf="isVisibleWrapInfoState$ | async">
            <div *ngIf="wrapInfo && !(loading$ | async)" class="wrap mt-2 mb-2 p-2">
            <div class="title">
                {{ 'SEND.WRAP.TITLE' | translate }}
                <i class="icon info-circle"></i>
            </div>
            <div class="text-wrap">
                {{ 'SEND.WRAP.MAIN_TEXT' | translate }}
            </div>
            <div class="title">{{ 'SEND.WRAP.ESTIMATE' | translate }}</div>
            <table class="text-wrap">
                <tr>
                    <td>{{ 'SEND.WRAP.WILL_RECEIVE' | translate }}</td>
                    <td *ngIf="!form.controls.amount.errors">
                        {{ getReceivedValue() | intToMoney }}
                        {{ 'SEND.WRAP.wZANO' | translate }}
                    </td>
                    <td *ngIf="form.controls.amount.errors">-</td>
                </tr>
                <tr>
                    <td>{{ 'SEND.WRAP.FEE' | translate }}</td>
                    <td>
                        {{ wrapInfo?.tx_cost?.zano_needed_for_erc20 | intToMoney : 12 }}
                        {{ 'SEND.WRAP.ZANO' | translate }}
                        ({{ '$' + wrapInfo.tx_cost?.usd_needed_for_erc20 }})
                    </td>
                </tr>
            </table>
        </div>
        </ng-container>

        <!-- Asset -->
        <div class="form__field">
            <label>
                {{ 'SEND.ASSET' | translate }}
                <span class="color-red">*</span>
            </label>
            <ng-select
                (change)="form.controls.amount.updateValueAndValidity()"
                [bindValue]="'asset_info.asset_id'"
                [clearable]="false"
                [items]="items$ | async"
                [searchable]="false"
                class="custom-select with-circle"
                formControlName="asset_id"
            >
                <ng-template let-asset="item" ng-label-tmp ng-option-tmp>
                    <img
                        [alt]="asset.asset_info.ticker"
                        [src]="getSrcByAsset(asset)"
                        height="15"
                        width="15"
                    />
                    {{ asset.asset_info.full_name ?? '***' }}
                    ({{ asset.total | intToMoney: asset.asset_info.decimal_point }} {{ asset.asset_info.ticker }})
                </ng-template>
            </ng-select>
            <div
                *ngIf="isVisibleErrorByControl(form.controls.asset_id)"
                class="error"
            >
                <div *ngIf="form.controls.asset_id.hasError('required')">
                    {{ 'ERRORS.REQUIRED' | translate }}
                </div>
            </div>
        </div>

        <!-- Details -->
        <div class="details mb-2">
            <button
                (click)="isVisibleAdditionalOptionsState = !isVisibleAdditionalOptionsState"
                [class.border-radius-all]="!isVisibleAdditionalOptionsState"
                class="header"
                type="button"
            >
                <span>{{ 'SEND.DETAILS' | translate }}</span>
                <i
                    [class.dropdown-arrow-down]="!isVisibleAdditionalOptionsState"
                    [class.dropdown-arrow-up]="isVisibleAdditionalOptionsState"
                    class="icon ml-1"
                ></i>
            </button>

            <div *ngIf="isVisibleAdditionalOptionsState" class="content">
                <!-- MIXIN -->
                <div class="form__field--row">
                    <div class="form__field">
                        <label for="send-mixin">
                            {{ 'SEND.MIXIN' | translate }}
                            <span class="color-red">*</span>
                        </label>
                        <input
                            (contextmenu)="variablesService.onContextMenu($event)"
                            [placeholder]="'PLACEHOLDERS.AMOUNT_PLACEHOLDER' | translate"
                            appInputValidate="integer"
                            class="form__field--input"
                            formControlName="mixin"
                            id="send-mixin"
                            maxlength="3"
                            type="text"
                        />
                        <div
                            *ngIf="isVisibleErrorByControl(form.controls.mixin)"
                            class="error"
                        >
                            <div *ngIf="form.controls.mixin.hasError('required')">
                                {{ 'ERRORS.REQUIRED' | translate }}
                            </div>
                            <div *ngIf="form.controls.mixin.hasError('min')">
                                {{ 'Min' }} {{ form.controls.mixin.getError('min')['min'] }}
                            </div>
                            <div *ngIf="form.controls.mixin.hasError('max')">
                                {{ 'Max' }} {{ form.controls.mixin.getError('max')['max'] }}
                            </div>
                        </div>
                    </div>

                    <div class="form__field">
                        <label for="send-fee">
                            {{ 'SEND.FEE' | translate }}
                            <span class="color-red">*</span>
                        </label>
                        <input
                            (contextmenu)="variablesService.onContextMenu($event)"
                            [placeholder]="'PLACEHOLDERS.FEE_PLACEHOLDER' | translate"
                            appInputValidate="money"
                            (blur)="updateFeeErrorMessage()"
                            class="form__field--input"
                            formControlName="fee"
                            id="send-fee"
                            type="text"
                        />
                        <div
                            *ngIf="isVisibleErrorByControl(form.controls.fee)"
                            class="error"
                        >
                            {{ errorMessages['fee'] | translate }}
                        </div>
                    </div>
                </div>

                <!-- HIDE -->
                <app-checkbox
                    [label]="'SEND.HIDE' | translate"
                    [value]="hideWalletAddress || form.controls['hide'].value"
                    class="mt-1"
                    formControlName="hide"
                ></app-checkbox>
            </div>
        </div>

        <button
            [disabled]="form.invalid || !variablesService.currentWallet.loaded"
            class="primary big max-w-19-rem w-100"
            type="submit"
        >
            {{ 'SEND.BUTTON' | translate }}
        </button>
    </form>
</div>

<app-send-modal (confirmed)="handleConfirmed($event)" *ngIf="isSendModalState"
                [sendMoneyParams]="form.getRawValue()"></app-send-modal>

<app-send-details-modal
    (eventClose)="handeCloseSendDetailsModal($event)"
    *ngIf="isSendDetailsModalState"
    [job_id]="job_id"
></app-send-details-modal>
