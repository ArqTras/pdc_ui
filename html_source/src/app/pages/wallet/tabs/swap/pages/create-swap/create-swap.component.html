<div class="container scrolled-content">
    <app-breadcrumbs [items]="breadcrumbItems" class="mb-2"></app-breadcrumbs>

    <form (ngSubmit)="beforeSubmit()" [formGroup]="form" class="form">
        <!-- Sending -->
        <div class="form__row" formGroupName="sending">
            <div class="form__field">
                <label for="sending-amount">
                    {{ 'CREATE_SWAP.FORM.LABELS.LABEL1' | translate }}
                </label>
                <input
                    (contextmenu)="variablesService.onContextMenu($event)"
                    [decimalPoint]="sendingDecimalPoint$ | async"
                    [placeholder]="'CREATE_SWAP.FORM.PLACEHOLDERS.PLACEHOLDER1' | translate"
                    appInputValidate="money"
                    class="form__field--input"
                    formControlName="amount"
                    id="sending-amount"
                    type="text"
                />
                <div
                    *ngIf="isVisibleErrorByControl(form.controls.sending.controls.amount) || isVisibleErrorByForm(form.controls.sending)"
                    class="error"
                >
                    <div *ngIf="form.controls.sending.controls.amount.hasError('zero')">
                        {{ 'SEND.FORM_ERRORS.AMOUNT_ZERO' | translate }}
                    </div>
                    <div *ngIf="form.controls.sending.controls.amount.hasError('required')">
                        {{ 'ERRORS.REQUIRED' | translate }}
                    </div>
                    <div
                        *ngIf="form.controls.sending.hasError('greater_than_maximum_amount')">
                        {{ 'ERRORS.MAX' | translate: { max: form.controls.sending.errors['greater_than_maximum_amount'].max } }}
                    </div>
                    <div *ngIf="form.controls.sending.hasError('insuficcientFunds')">
                        {{ form.controls.sending.errors['insuficcientFunds'].errorText | translate }}
                    </div>
                    <div *ngIf="form.controls.sending.hasError('assetHasNotBeenAddedToWallet')">
                        {{ form.controls.sending.errors['assetHasNotBeenAddedToWallet'].errorText | translate }}
                    </div>
                </div>
            </div>

            <div class="form__field">
                <label> &nbsp; </label>
                <ng-select
                    (change)="form.controls.sending.controls.amount.updateValueAndValidity()"
                    [bindValue]="'asset_id'"
                    [clearable]="false"
                    [items]="sendingAssetsInfo$ | async"
                    [searchable]="false"
                    class="custom-select with-circle"
                    formControlName="asset_id"
                >
                    <ng-template let-assetInfo="item" ng-label-tmp ng-option-tmp>
                        <img
                            [alt]="assetInfo.ticker"
                            [src]="getSrcByAssetInfo(assetInfo)"
                            height="15"
                            width="15"
                        />
                        {{ assetInfo.full_name || '---' }}
                    </ng-template>
                </ng-select>
            </div>
        </div>
        <!-- /sending -->

        <div class="wrapper-reverse">
            <button (click)="reverse()" [disabled]="currentWallet.isEmptyAssetsInfoWhitelist" class="revers"
                    type="button">
                <i class="icon small swap"></i>
            </button>
        </div>

        <!-- Receiving -->
        <div class="form__row" formGroupName="receiving">
            <div class="form__field">
                <label for="receiving-amount">
                    {{ 'CREATE_SWAP.FORM.LABELS.LABEL2' | translate }}
                </label>
                <input
                    [decimalPoint]="receivingDecimalPoint$ | async"
                    [placeholder]="'CREATE_SWAP.FORM.PLACEHOLDERS.PLACEHOLDER1' | translate"
                    appInputValidate="money"
                    class="form__field--input"
                    formControlName="amount"
                    id="receiving-amount"
                    type="text"
                />
                <div
                    *ngIf="isVisibleErrorByControl(form.controls.receiving.controls.amount) ||
                    isVisibleErrorByForm(form.controls.receiving)"
                    class="error"
                >
                    <div *ngIf="form.controls.receiving.controls.amount.hasError('required')">
                        {{ 'ERRORS.REQUIRED' | translate }}
                    </div>
                    <div *ngIf="form.controls.receiving.controls.amount.hasError('zero')">
                        {{ 'SEND.FORM_ERRORS.AMOUNT_ZERO' | translate }}
                    </div>
                    <div
                        *ngIf="form.controls.receiving.hasError('greater_than_maximum_amount')">
                        {{ 'ERRORS.MAX' | translate: { max: form.controls.receiving.errors['greater_than_maximum_amount'].max } }}
                    </div>
                    <div *ngIf="form.controls.receiving.hasError('assetHasNotBeenAddedToWallet')">
                        {{ form.controls.receiving.errors['assetHasNotBeenAddedToWallet'].errorText | translate }}
                    </div>
                </div>
            </div>

            <div class="form__field">
                <label> &nbsp; </label>
                <ng-select
                    [bindValue]="'asset_id'"
                    [clearable]="false"
                    [items]="receivingAssetsInfo$ | async"
                    [searchable]="false"
                    class="custom-select with-circle"
                    formControlName="asset_id"
                >
                    <ng-template let-assetInfo="item" ng-label-tmp ng-option-tmp>
                        <img
                            [alt]="assetInfo.ticker"
                            [src]="getSrcByAssetInfo(assetInfo)"
                            height="15"
                            width="15"
                        />
                        {{ assetInfo.full_name || '---' }}
                    </ng-template>
                </ng-select>
                <div
                    *ngIf="
                        form.controls.receiving.controls.asset_id.invalid &&
                        (form.controls.receiving.controls.asset_id.dirty ||
                            form.controls.receiving.controls.asset_id.touched ||
                            form.touched)
                    "
                    class="error"
                >
                    <div *ngIf="form.controls.receiving.controls.asset_id.hasError('sameAssetsId')">
                        {{ 'CREATE_SWAP.FORM.ERRORS.ERROR1' | translate }}
                    </div>
                </div>
            </div>
        </div>
        <!-- /receiving -->

        <div class="form__field form__field-dropdown">
            <label for="receiving-address">
                {{ 'CREATE_SWAP.FORM.LABELS.LABEL3' | translate }}
            </label>
            <input
                (contextmenu)="variablesService.onContextMenu($event)"
                (focusout)="isVisibleDropdownAliases$.next(false)"
                (input)="inputListenReceiverAddressField($event)"
                (paste)="pasteListenReceiverAddressField($event)"
                [lowerCaseDisabled]="lowerCaseDisabled$ | async"
                [placeholder]="'PLACEHOLDERS.ADRESS_PLACEHOLDER' | translate"
                class="form__field--input"
                formControlName="receiverAddress"
                id="receiving-address"
                lowerCase
                type="text"
            />

            <div
                *ngIf="isVisibleDropdownAliasesObservable$ | async"
                [ngStyle]="{
                    'z-index': 1
                }"
                class="dropdown py-0_5 border-radius-0_8-rem bg-light-blue-details"
            >
                <ng-container *ngIf="aliases$ | async as aliases">
                    <ng-container *ngIf="aliases.length; else notFoundAliases">
                        <div (click)="form.controls.receiverAddress.patchValue(alias.name)"
                             *ngFor="let alias of aliases" class="item">
                            <div
                                [class.available]="alias.name.length >= 2 && alias.name.length <= 6"
                                [class.pl-1]="alias.name.length > 6"
                                class="alias"
                            >
                                <div class="text-ellipsis">{{ alias.name }}</div>
                            </div>
                        </div>
                    </ng-container>
                    <ng-template #notFoundAliases>
                        <div class="item pl-1">Not found aliases</div>
                    </ng-template>
                </ng-container>
            </div>

            <div
                *ngIf="isVisibleErrorByControl(form.controls.receiverAddress)"
                class="error"
            >
                <div *ngIf="form.controls.receiverAddress.errors['address_not_valid']">
                    {{ 'SEND.FORM_ERRORS.ADDRESS_NOT_VALID' | translate }}
                </div>
                <div *ngIf="form.controls.receiverAddress.errors['alias_not_found']">
                    {{ 'SEND.FORM_ERRORS.ALIAS_NOT_FOUND' | translate }}
                </div>
                <div *ngIf="form.controls.receiverAddress.errors['alias_not_valid']">
                    {{ 'SEND.FORM_ERRORS.ALIAS_NOT_VALID' | translate }}
                </div>
                <div *ngIf="form.controls.receiverAddress.hasError('required')">
                    {{ 'ERRORS.REQUIRED' | translate }}
                </div>
            </div>

            <div *ngIf="aliasAddress" class="info text-ellipsis">
                <span>{{ aliasAddress | zanoShortString }}</span>
            </div>
        </div>

        <div class="actions">
            <button [disabled]="form.invalid || (loading$ | async)" class="btn primary big w-100" type="submit">
                <ng-container *ngIf="!(loading$ | async)">{{ 'CREATE_SWAP.FORM.BUTTONS.BUTTON1' | translate }}
                </ng-container>
                <zano-loader *ngIf="loading$ | async" [type]="'circle'"></zano-loader>
            </button>
            <a class="btn outline big w-100"
               routerLink="/wallet/swap">{{ 'CREATE_SWAP.FORM.BUTTONS.BUTTON2' | translate }}</a>
        </div>

        <div *ngIf="errorRpc" class="error mt-2">
            {{ 'ERRORS.INVALID_PROPOSAL' | translate }}
        </div>
    </form>
</div>
